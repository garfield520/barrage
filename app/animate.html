<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style lang="">
        .demo {
            width: 100px;
            height: 100px;
            background: #399;
            position: absolute;
            left: 500px;
            /* transform: translateX(-100px);    */
        }
        button {
            position: absolute;
            top: 200px;
        }
        #run {
            left: 30px;
        }
        #stop {
            left: 90px;
        }
        #continue {
            left: 150px;
        }
    </style>
</head>
<body>
    <div class="demo" id="demo"></div>
    <button id="run">run</button>
    <button id="stop">stop</button>
    <button id="continue">continue</button>

    <script>
        
        var timerId = 0;

        function cacelAnimate ( id ) {
            cancelAnimationFrame( id );
        }
        
        function animate ( elem, toDestance, config ) {
            var isFirstTime = true;
            //  动画开始时间点
            var startTime = 0;
            //  时间间隔
            var timeInterval = 0;
            //  上次一帧动画执行时间点
            var lastTime = 0;
            //  每帧动画运动步长
            var step = 0;
            //  总距离
            var totalDistance = 0;
            //  总时间(ms)
            var totalTime = config.duration;
            //  当前位置
            var currentPosition = 0;
            //  方向
            var directive = '';
            //  经过的距离
            var passedDistance = 0;
            //  经过的时间
            var passedTime = 0;
            
            var currentTransform = getComputedStyle(elem).transform;
            if ( currentTransform == 'none' ) {
                totalDistance = parseFloat(toDestance);
            } else {
                currentPosition = parseFloat(currentTransform.substring(10, currentTransform.length - 1).split(',')[3]);
                totalDistance = parseFloat(toDestance) - currentPosition;
            }
            if ( totalDistance <= 0 ) {
                directive = '-';
            }
            
            // console.log('总距离：' + totalDistance);
            // console.log('总时间：' + totalTime);

            requestAnimationFrame( _loop );

            function _loop ( t ) {
                if ( isFirstTime ) {
                    startTime = lastTime = t;
                    isFirstTime = false;
                    requestAnimationFrame( _loop );
                } else {
                    //  每帧动画时间间隔
                    timeInterval = t - lastTime;
                    //  记录本帧动画执行时间点
                    lastTime = t;

                    step = totalDistance / totalTime * timeInterval;
                    currentPosition += step;
                    passedDistance += step;
                    passedTime = t - startTime;
                    
                    elem.style.transform = 'translateX(' + currentPosition +'px)';

                    config.progress( passedTime, Math.abs(passedDistance) );

                    if ( Math.abs(passedDistance) < Math.abs(totalDistance) ) {
                        timerId = requestAnimationFrame(_loop)
                    } else {
                        currentPosition = totalDistance;
                        elem.style.transform = 'translateX(' + toDestance +'px)';
                        config.complete();
                    }
                }
            }
        }

        //================================================
        
        var demo = document.getElementById('demo');
        var runBtn = document.getElementById('run');
        var stopBtn = document.getElementById('stop');
        var continueBtn = document.getElementById('continue');

        var duration = 3000;
        var destination = -500;

        var passedTime = 0;
        var passedDistance = 0;

        var totalTime = duration;

        runBtn.onclick = function () {
            animate(demo, destination, {
                duration: duration,
                progress: function ( _passedTime, _passedDistance ) {
                    passedTime = _passedTime;
                    passedDistance = _passedDistance;
                },
                complete: function () {
                    console.log('animation ended')
                }
            });
        }

        stopBtn.onclick = function () {
            cacelAnimate(timerId);
        }
        
        continueBtn.onclick = function () {
            totalTime = totalTime - passedTime;
            console.log(totalTime);
            animate(demo, destination, {
                duration: totalTime,
                progress: function ( _passedTime, _passedDistance ) {
                    passedTime = _passedTime;
                    passedDistance = _passedDistance;
                },
                complete: function () {
                    console.log('animation ended')
                }
            });
        }

    </script>
</body>
</html>